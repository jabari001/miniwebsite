<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your safe place</title>
    <link rel="stylesheet" type="text/css" href="home.css">
</head>

   
   <body>
  <div class="container">
    <h1>This is your safe place</h1>

    <h2 id="welcome"></h2>

      <div id="response-box" class="response"></div>

    <textarea id="confession" placeholder="write your confession here" rows="7"></textarea>

    <button onclick="sendConfession()" class="btn">Send</button>

  
  </div>


<script>
  // ===== USER NAME =====
  const params = new URLSearchParams(window.location.search);
  const user = params.get('user');
  document.getElementById('welcome').innerText = `Welcome, ${user}! `;

  let conversationStep = 0;

  // ===== DEPTH DETECTION =====
  const depthWords = [
    "months","years","long time","always","never","tired","exhausted",
    "drained","alone","hopeless","broken","empty","scared","lost",
    "job","relationship","divorce","death","grief",
    "fear","pain","hurt","sad","depressed","anxious","anxiety","stressed"
  ];

  function containsDepth(text) {
    return depthWords.some(word => text.toLowerCase().includes(word));
  }

  // ===== QUESTIONS =====
  const questionSets = [
    [
      "What is the one thing that's hurting you the most right now?",
      "How does this pain affect your daily life when you're alone?",
      "If you could speak freely without being judged, what would you say?"
    ],
    [
      "What has been draining your strength lately?",
      "When was the last time you truly felt at peace?",
      "What do you wish you could walk away from right now?"
    ],
    [
      "Who is the person that has affected your heart the most?",
      "What did they do that still hurts you today?",
      "What would you tell them if they were listening?"
    ],
    [
      "What is your biggest fear about yourself?",
      "What negative thoughts do you tell yourself when no one is watching?",
      "What do you think you are not good enough for?"
    ],
    [
      "What do you wish would change in your life right now?",
      "What is one thing you are secretly hoping for?",
      "If life restarted today, what would you do differently?"
    ]
  ];

  // ===== COMFORT =====
  const comfortingMessages = [
    "You have been carrying this for a long time. You are not weak for feeling this way.",
    "It’s okay to be tired. You don’t have to fix everything today.",
    "What you felt mattered. Your pain is real.",
    "You are not your worst thoughts. You are trying — and that matters.",
    "Hope exists even when it feels far away."
  ];

  // ===== VALIDATION =====
  const validationMessages = [
    "That sounds heavy. You don’t have to rush.",
    "I hear you. You can take your time.",
    "That must be exhausting to live with.",
    "Thank you for trusting me with this."
  ];

  const deepFollowUps = [
    "I'm happy to listen if, you can tell me more about it.",
    "What has this been like emotionally?",
    "What’s the hardest part of carrying this?",
    "What do you wish people understood?"
  ];

  function randomFrom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // ===== DAILY LIMIT =====
  const today = new Date().toLocaleDateString();
  if (localStorage.getItem("lastVisitDate") === today) {
    alert("You’ve already used today’s session. Please come back tomorrow.");
    document.getElementById("confession").disabled = true;
    document.querySelector("button").disabled = true;
    throw new Error("Session locked");
  }
  localStorage.setItem("lastVisitDate", today);

  // ===== PICK NEW QUESTION SET =====
  let lastSet = localStorage.getItem("lastQuestionSet");
  let newSet;
  do {
    newSet = Math.floor(Math.random() * questionSets.length);
  } while (newSet == lastSet);

  localStorage.setItem("lastQuestionSet", newSet);

  const questions = questionSets[newSet];
  const responseBox = document.getElementById("response-box");

  // ===== TYPING EFFECT =====
  function typeText(el, text, speed = 60) {
    el.innerHTML = "";
    let i = 0;
    const timer = setInterval(() => {
      if (i < text.length) {
        el.innerHTML += text.charAt(i);
        i++;
      } else {
        clearInterval(timer);
      }
    }, speed);
  }

  // ===== SHOW FIRST QUESTION =====
  const firstQ = document.createElement("p");
  firstQ.classList.add("question");
  firstQ.innerHTML = "<em></em>";
  responseBox.appendChild(firstQ);
  typeText(firstQ.querySelector("em"), questions[0]);

  // ===== MAIN FUNCTION =====
  function sendConfession() {
    const input = document.getElementById("confession");
    const text = input.value.trim();

    if (text === "") return alert("Please write something.");

    responseBox.innerHTML += `<p class="answer"><strong>You:</strong> ${text}</p>`;

    //  EMOTIONAL PAUSE
    if (containsDepth(text)) {
      responseBox.innerHTML += `
        <p class="therapist">
          <em>${randomFrom(validationMessages)}</em><br>
          <em>${randomFrom(deepFollowUps)}</em>
        </p>
      `;
      input.rows = 6;
      input.placeholder = "You can write more here...";
      input.value = "";
      return;
    }

    // NEXT QUESTION 
    if (conversationStep < questions.length - 1) {
      conversationStep++;

      const q = document.createElement("p");
      q.classList.add("question");
      q.innerHTML = "<em></em>";
      responseBox.appendChild(q);

      typeText(q.querySelector("em"), questions[conversationStep]);

      input.rows = 2;
      input.placeholder = "Write here...";
    } else {
      responseBox.innerHTML += `<p class="comfort"><em>${comfortingMessages[newSet]}</em></p>`;
      input.disabled = true;
      document.querySelector("button").disabled = true;
    }

    input.value = "";
  }
</script>

</body>
</html>